import axios from "axios";
import fs from "fs-extra";
import path from "path";

class QuotesCommand {
  constructor() {
    this.name = "Ø§Ù‚ØªØ¨Ø§Ø³";
    this.author = "Ø­Ø³ÙŠÙ† ÙŠØ¹Ù‚ÙˆØ¨ÙŠ";
    this.role = 0;
    this.description = "ÙŠØ±Ø³Ù„ Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª Ø¹Ù…ÙŠÙ‚Ø© Ù…Ø¹ ØµÙˆØ± Ù…Ø¹Ø¨Ø±Ø©";
    this.cooldowns = 10;
    this.aliases = ["Ø¥Ù‚ØªØ¨Ø§Ø³", "Ø§Ù‚ØªØ¨Ø§Ø³Ø§Øª"];
  }

  quotes = [
    `Ù„Ù€Ù€ÙŠÙ€Ù€ØªÙ€Ù€Ù€Ù€Ù€Ù†Ø§ Ù†Ù€Ù€Ù€Ø³Ù€Ù€Ù€ØªÙ€Ù€Ù€Ø·Ù€Ù€Ù€ÙŠÙ€Ù€Ù€Ø¹ Ø¥ÙŠÙ€Ù€Ù‚Ù€Ù€Ø§Ù Ø§Ù„Ù€Ù€Ù€Ù€Ù€Ù€Ù€Ø²Ù…Ù€Ù€Ù€Ù€Ù† Ø¹Ù€Ù€Ù€Ù€Ù„Ù€Ù€Ù€Ù€Ù€Ù‰ Ù„Ù€Ù€Ù€Ù€Ù€Ø­Ù€Ù€Ù€Ù€Ù€Ø¸Ù€Ù€Ù€Ù€Ù€Ø§Øª ÙƒÙ€Ù€Ù€Ù†Ù€Ù€Ù€Ø§ Ø¨Ù€Ù€Ù€Ù€Ù€Ù‡Ù€Ù€Ù€Ù€Ù€Ù€Ø§ Ø³Ù€Ù€Ø¹Ù€Ù€Ø¯Ø§Ø¡ 
â°â°.â°â°ğŸ–¤ğŸ·ğ•€ ğ•¨ğ•šğ•¤ğ•™ ğ•¨ğ•– ğ•”ğ• ğ•¦ğ•ğ•• ğ•¤ğ•¥ğ• ğ•¡ ğ•¥ğ•šğ•ğ•– ğ• ğ•Ÿ ğ•ğ• ğ•ğ•–ğ•Ÿğ•¥ğ•¤ ğ•¨ğ•™ğ•–ğ•Ÿ ğ•¨ğ•– ğ•¨ğ•–ğ•£ğ•– ğ•™ğ•’ğ•¡ğ•¡ğ•ª â°â°.â°â°ğŸ–¤ğŸ·`,
    `Ø£Ø­Ø¯Ù‡Ù… ÙŠØ¶Ø­Ùƒ ÙˆØ£Ø­Ø¯Ù‡Ù… ÙŠØ¨ÚªÙŠ ØŒ Ø£Ø­Ø¯Ù‡Ù… ÙŠÙØ±ÙŠØ¯ Ø§Ù„Ø¹ÙŠØ´ ÙˆØ§Ù„Ø¢Ø®Ø± ÙŠØ´ØªÙ‡ÙŠ Ø§Ù„Ù…ÙˆØª ØŒ ÙˆØ£Ø­Ø¯Ù‡Ù… Ù„Ù… ÙŠØ¹Ø¯ ÙŠØ¨Ø§Ù„ÙŠ ..
ÙˆØ¬Ù…ÙŠØ¹Ù‡Ù… Ø£Ù†Ø§ ğŸ¤ğŸ¥‚ğŸ‚ğŸ–¤ğŸ—ğŸ¥€
ğ’ğ’ğ’† ğ’ğ’‡ ğ’•ğ’‰ğ’†ğ’ ğ’ğ’‚ğ’–ğ’ˆğ’‰ğ’”, ğ’ğ’ğ’† ğ’ğ’‡ ğ’•ğ’‰ğ’†ğ’ ğ’„ğ’“ğ’Šğ’†ğ’”, ğ’ğ’ğ’† ğ’ğ’‡ ğ’•ğ’‰ğ’†ğ’ ğ’˜ğ’‚ğ’ğ’•ğ’” ğ’•ğ’ ğ’ğ’Šğ’—ğ’†, ğ’•ğ’‰ğ’† ğ’ğ’•ğ’‰ğ’†ğ’“ ğ’ğ’ğ’ğ’ˆğ’” ğ’‡ğ’ğ’“ ğ’…ğ’†ğ’‚ğ’•ğ’‰, ğ’‚ğ’ğ’… ğ’ğ’ğ’† ğ’ğ’‡ ğ’•ğ’‰ğ’†ğ’ ğ’ğ’ ğ’ğ’ğ’ğ’ˆğ’†ğ’“ ğ’„ğ’‚ğ’“ğ’†ğ’”.
 ğ’‚ğ’ğ’… ğ’‚ğ’ğ’ ğ’ğ’‡ ğ’•ğ’‰ğ’†ğ’ ğ’‚ğ’“ğ’† ğ’ğ’† ğŸ–¤ğŸ¦‹ğŸ¥€ğŸ¤ğŸ»ğŸ“œ`,
    `Ù„Ø§ ØªÙŠØ£Ø³ ÙˆØ£Ù†Øª ØªØ¹Ù„Ù… Ø£Ù† Ø§Ù„Ù„Ù‡ Ø¯ÙˆÙ…Ø§Ù‹ ÙŠØ®Ù„Ù‚ Ù†ÙˆØ±Ø§Ù‹ Ø¬Ø¯ÙŠØ¯Ø§Ù‹ Ø¨Ø¹Ø¯ ÙƒÙ„ Ø¸Ù„Ø§Ù…ğŸ§šâ€â™€ï¸ğŸ—
ğ‘«ğ’ğ’'ğ’• ğ’…ğ’†ğ’”ğ’‘ğ’‚ğ’Šğ’“ ğ’˜ğ’‰ğ’Šğ’ğ’† ğ’šğ’ğ’– ğ’Œğ’ğ’ğ’˜ ğ’•ğ’‰ğ’‚ğ’• ğ‘¨ğ’ğ’ğ’‚ğ’‰ ğ’‚ğ’ğ’˜ğ’‚ğ’šğ’” ğ’„ğ’“ğ’†ğ’‚ğ’•ğ’†ğ’” ğ’ğ’†ğ’˜ ğ’ğ’Šğ’ˆğ’‰ğ’• ğ’‚ğ’‡ğ’•ğ’†ğ’“ ğ’†ğ’—ğ’†ğ’“ğ’š ğ’…ğ’‚ğ’“ğ’Œğ’ğ’†ğ’”ğ’”ğŸ§šâ€â™€ï¸`,
    `Ø³ÙˆÙ ÙŠØ´ØªØ§Ù‚ÙˆÙ† Ø§Ù„ÙŠÙƒ, Ø¹Ù†Ø¯Ù…Ø§ ÙŠÙØ´Ù„ÙˆÙ† ÙÙŠ Ø§Ù„Ø¹Ø«ÙˆØ± Ø¹Ù„Ù‰ Ø´Ø®Øµ Ù…Ø«Ù„Ùƒ. ğŸ¥€ğŸŒº
ğ“£ğ“±ğ“®ğ”‚ ğ”€ğ“²ğ“µğ“µ ğ“¶ğ“²ğ“¼ğ“¼ ğ”‚ğ“¸ğ“¾ , ğ“¦ğ“±ğ“®ğ“· ğ“£ğ“±ğ“®ğ”‚ ğ“¯ğ“ªğ“²ğ“µ ğ“£ğ“¸ ğ“¯ğ“²ğ“·ğ““ ğ“¼ğ“¸ğ“¶ğ“®ğ“¸ğ“·ğ“® ğ“›ğ“²ğ“´ğ“® ğ“¨ğ“¸ğ“¾ğŸ¦‹ğŸ’œ`,
    `Ù„Ø§ Ø´ÙŠ ÙŠØ¨Ù‚Ù€Ù€Ù€Ù‰ Ù„Ù„Ø£Ø¨Ø¯ Ø­ØªÙ‰ Ø§Ù„Ø´Ù…Ø³ Ø³Ù€ØªÚ¯Ø³Ø± Ø§Ù„Ù‚Ø§Ù†ÙˆÙ† ÙŠÙˆÙ…Ø§Ù‹ ÙˆØªØ´Ø±Ù‚ ØºØ§Ø±Ø¨Ø§Ù‹ Ù„ØªØ¹Ù„Ù† Ø§Ù„Ù†Ù‡Ø§ÙŠØ©ğŸ§¡âœ¨
ğ‘µğ‘¶ğ‘»ğ‘¯ğ‘°ğ‘µğ‘® ğ‘¹ğ‘¬ğ‘´ğ‘¨ğ‘°ğ‘µğ‘º ğ‘­ğ‘¶ğ‘¹ğ‘¬ğ‘½ğ‘¬ğ‘¹, ğ‘¼ğ‘µğ‘»ğ‘°ğ‘³ ğ‘»ğ‘¯ğ‘¬ ğ‘ºğ‘¼ğ‘µ ğ‘¾ğ‘°ğ‘³ğ‘³ ğ‘©ğ‘¹ğ‘¬ğ‘¨ğ‘² âœ¨ğŸ§¡`,
    `"Ø£Ø­ÙŠØ§Ù†Ø§Ù‹ Ù„Ø§ ÙŠØªÙˆØ¬Ø¨ Ø¹Ù„ÙŠÙƒ Ø³Ù…Ø§Ø¹ Ø§Ø¹Ø°Ø§Ø±Ù‡Ù…ØŒ Ù„Ø£Ù† Ø§ÙØ¹Ø§Ù„Ù‡Ù… Ù‚Ø§Ù„Øª ÙƒÙ„ Ø§Ù„Ø­Ù‚ÙŠÙ‚Ø© ".ğŸ–¤ğŸ¶ğŸ¥€
"Sğ”¬ğ”ªğ”¢ğ”±ğ”¦ğ”ªğ” ğ”­ ğ”¶ğ”¬ğ”² ğ”¡ğ”¬ ğ”«ğ”¬ğ”± ğ”¥ğ”ğ”³ğ”  ğ”±ğ”¥ğ”¦ğ”¦ğ”° ğ”¥ğ”ğ”ğ”¯ ğ”­ğ”¢ğ”¬ğ”¦ğ”­ğ”° ğ”ğ”«ğ”Ÿğ”ğ”¦ğ”¤ ğ”­ğ”ğ”ğ”¤ ğ”ğ”©ğ” ğ”±ğ”°ğ”¦ğ”¤ğ”± ğ”¯ğ”¯ğ”ğ”´ğ” "ğŸ–¤ğŸ¶ğŸ¥€`,
    `Ù…Ù‡Ù…Ø§ Ø­Ø§ÙˆÙ„Øª Ø£Ù† Ø£à¢ªØ¯ Ø§Ù„Ø¥Ø³Ø§Ø¡Ø© Ø¨Ø§Ù„Ø¥Ø³Ø§Ø¡Ø© Ø› ØºÙ„Ø¨Ù†ÙŠ Ø§Ù„Ø£ØµÙ„ Ø§Ù„Ø·ÙŠØ¨ ğŸ¤ğŸ˜‡
ğ‘µğ’ ğ’ğ’‚ğ’•ğ’•ğ’†ğ’“ ğ’‰ğ’ğ’˜ ğ’ğ’–ğ’„ğ’‰ ğ‘° ğ’•ğ’“ğ’š ğ’•ğ’ ğ’“ğ’†ğ’‘ğ’‚ğ’š ğ’ğ’‡ğ’‡ğ’†ğ’ğ’”ğ’† ğ’˜ğ’Šğ’•ğ’‰ ğ’ğ’‡ğ’‡ğ’†ğ’ğ’”ğ’†, ğ’•ğ’‰ğ’† ğ’ˆğ’ğ’ğ’… ğ’ğ’“ğ’Šğ’ˆğ’Šğ’ ğ’‘ğ’“ğ’†ğ’—ğ’‚ğ’Šğ’ğ’” ğ’ğ’—ğ’†ğ’“ ğ’ğ’† ğŸ¥ºğŸ¤`,
    `ÙˆÙŠØ¨Ù‚Ù‰ Ø§Ù„Ø§Ø´ØªÙŠØ§Ù‚ ÙÙŠ Ø§Ù„Ù‚Ù„Ø¨ Ù„Ø§ ÙŠØ´Ø¹Ø± Ø¨Ù‡ Ø§Ø­Ø¯ğŸ¥€
Ø§Ù„ÙƒØ±Ø§Ù…Ø© Ø¬Ù…ÙŠÙ„Ø© Ø­ØªÙ‰ ÙˆØ¥Ù† Ø¬Ø¹Ù„ØªÙƒ ÙˆØ­ÙŠØ¯Ø§Ù‹ ğŸ–¤ğŸ¦‹ğŸ¥€
.ğ’…ğ’Šğ’ˆğ’ğ’Šğ’•ğ’š ğ’Šğ’” ğ’ƒğ’†ğ’‚ğ’–ğ’•ğ’Šğ’‡ğ’–ğ’ ğ’†ğ’—ğ’†ğ’ ğ’Šğ’‡ ğ’Šğ’• ğ’ğ’‚ğ’Œğ’†ğ’” ğ’šğ’ğ’– ğ’‚ğ’ğ’ğ’ğ’†.ğŸ–¤ğŸ¶ÙØ±Ø§Ø´Ø© Ø§Ù„Ø²Ù‡ÙˆØ± ğŸ¥¹`,
    `â¤Ø£Ø¬Ù…Ù„ ÙˆØ£Ø±ÙˆØ¹ Ù‡Ù†Ø¯Ø³Ø© ÙÙŠ Ø§Ù„Ø¹Ø§Ù„Ù… Ø£Ù† ØªØ¨Ù†ÙŠ Ø¬Ø³Ø±Ø§Ù‹ Ù…Ù† Ø§Ù„Ø£Ù…Ù„ Ø¹Ù„Ù‰ Ù†Ù‡Ø± Ù…Ù† Ø§Ù„ÙŠØ£Ø³ ğŸ–¤ğŸª„`,
    `Ø§Ù„Ø­ÙŠØ§Ø© Ø±ÙˆØ§ÙŠØ©ÙŒ Ø¬Ù…ÙŠÙ„Ø©ÙŒ Ø¹Ù„ÙŠÙƒ Ù‚Ø±Ø§Ø¡ØªÙ‡Ø§ Ø­ØªÙ‰ Ø§Ù„Ù†Ù‡Ø§ÙŠØ©ØŒ Ù„Ø§ ØªØªÙˆÙ‚Ù Ø£Ø¨Ø¯Ø§Ù‹ Ø¹Ù†Ø¯ Ø³Ø·Ø±Ù Ø­Ø²ÙŠÙ†ÙØŒ Ù‚Ø¯ ØªÙƒÙˆÙ† Ø§Ù„Ù†Ù‡Ø§ÙŠØ© Ø¬Ù…ÙŠÙ„Ø©Ù‹ . . ğŸ©·ğŸ‚ğŸ¦‹"
 ğ‹ğ¢ğŸğ ğ¢ğ¬ ğš ğ›ğğšğ®ğ­ğ¢ğŸğ®ğ¥ ğ§ğ¨ğ¯ğğ¥ ğ­ğ¡ğšğ­ ğ²ğ¨ğ® ğ¡ğšğ¯ğ ğ­ğ¨ ğ«ğğšğ ğ­ğ¨ ğ­ğ¡ğ ğğ§ğ, ğ§ğğ¯ğğ« ğ¬ğ­ğ¨ğ© ğšğ­ ğš ğ¬ğšğ ğ¥ğ¢ğ§ğ, ğ­ğ¡ğ ğğ§ğ ğ¦ğšğ² ğ›ğ ğ›ğğšğ®ğ­ğ¢ğŸğ®ğ¥ . . ğŸ©·ğŸ’™ğŸ‚`,
  ];

  async execute({ api, event }) {
    try {
      api.setMessageReaction("â³", event.messageID, (err) => {}, true);

      const randomQuote = this.quotes[Math.floor(Math.random() * this.quotes.length)];

      // Ø§Ù„Ø¨Ø­Ø« Ø¹Ù† ØµÙˆØ±Ø© Ø¹Ø´ÙˆØ§Ø¦ÙŠØ©
      const searchQueries = ["beautiful flowers", "sunset", "nature", "aesthetic", "peace"];
      const randomQuery = searchQueries[Math.floor(Math.random() * searchQueries.length)];

      try {
        const searchUrl = `https://deku-rest-api.gleeze.com/api/pinterest?q=${encodeURIComponent(randomQuery)}`;
        const response = await axios.get(searchUrl, { timeout: 10000 });
        const imageLinks = response.data.result || [];

        if (imageLinks.length > 0) {
          const imageUrl = imageLinks[0];

          try {
            const imageResponse = await axios.get(imageUrl, {
              responseType: "arraybuffer",
              timeout: 15000
            });

            const imagePath = path.join(process.cwd(), "cache", `quote_${Date.now()}.jpg`);
            await fs.ensureDir(path.join(process.cwd(), "cache"));
            await fs.writeFile(imagePath, imageResponse.data);

            const imageStream = fs.createReadStream(imagePath);

            api.setMessageReaction("ğŸ’–", event.messageID, (err) => {}, true);

            await api.sendMessage({
              body: randomQuote,
              attachment: imageStream
            }, event.threadID);

            // Ø­Ø°Ù Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ù…Ø¤Ù‚ØªØ©
            setTimeout(() => {
              try {
                fs.unlinkSync(imagePath);
              } catch (e) {}
            }, 3000);

            return;
          } catch (imageErr) {
            console.warn("[QUOTES] Failed to download image:", imageErr.message);
          }
        }
      } catch (apiErr) {
        console.warn("[QUOTES] Failed to fetch image from API:", apiErr.message);
      }

      // Ø¥Ø°Ø§ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„ Ø§Ù„ØµÙˆØ±Ø©ØŒ Ø£Ø±Ø³Ù„ Ø§Ù„Ø§Ù‚ØªØ¨Ø§Ø³ ÙÙ‚Ø·
      api.setMessageReaction("âœ…", event.messageID, (err) => {}, true);
      return api.sendMessage(randomQuote, event.threadID);

    } catch (error) {
      console.error("[QUOTES] Error:", error.message);
      api.setMessageReaction("âŒ", event.messageID, (err) => {}, true);
      return api.sendMessage("âŒ | Ø­Ø¯Ø« Ø®Ø·Ø£ Ø£Ø«Ù†Ø§Ø¡ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹", event.threadID, event.messageID);
    }
  }
}

export default new QuotesCommand();
